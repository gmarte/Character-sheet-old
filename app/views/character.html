<div ng-show="mode == 'view'" id="{{c.info.name.toLowerCase()}}" ng-repeat="c in characters">
	<h2>
		{{c.info.name}}&#32;
		<small ng-if="c.info.cr">
			CR&#32;{{c.info.cr}}&#32;
		</small>
		<small ng-if="c.info.mr">
			MR&#32;{{c.info.mr}}
		</small>
		<span class="mode-switcher" ng-if="$index == 0">
			<a download="{{blob.name}}" ng-href="{{blob.url}}"><i class="fa fa-download"></i></a>
			<i ng-click="switchMode('edit')" class="fa fa-edit"></i>
		</span>
	</h2>
	<hr>
	<section id="{{c.info.name.toLowerCase()}}-info">
		<img ng-if="c.info.portrait" ng-src="{{c.info.portrait}}" class="visible-xs col-xs-12 portrait-xs img-responsive img-thumbnail">
		<img ng-if="c.info.portrait" ng-src="{{c.info.portrait}}" class="hidden-xs col-sm-4 portrait-sm img-responsive img-thumbnail pull-right">
		<p>
			<md c="c" ng-if="c.info.templates" md="c.info.templates">&#32;</md>
			<md c="c" ng-if="c.info.race" md="c.info.race">&#32;</md>
			<md c="c" ng-if="c.info.classes" md="c.info.classes">&#32;</md>
		</p>
		<p>
			<md c="c" ng-if="c.info.alignment" md="c.info.alignment">&#32;</md>
			<md c="c" ng-if="c.info.size" md="c.info.size">&#32;</md>
			<md c="c" ng-if="c.info.type" md="c.info.type">&#32;</md>
			<span ng-if="c.info.subtypes">(<md c="c" ng-repeat="subtype in c.info.subtypes" md="subtype"><span ng-if="!$last">,&#32;</span></md>)</span>
		</p>
		<p>
			<b>Initiative</b>&#32;
			<roll name="'Initiative'" die="pf.concat('1d20', c.info.initiative)"></roll>;
			<span ng-if="c.info.senses">
				<b>Senses</b>&#32;
				<md c="c" ng-repeat="sense in c.info.senses" md="sense"><span ng-if="!$last">,&#32;</span></md>;
			</span>
			<b>Perception</b>&#32;
			<roll name="c.perception.name" die="c.perception.roll()"></roll>
		</p>
		<p ng-if="c.info.auras">
			<b>Auras</b>&#32;
			<md c="c" ng-repeat="aura in c.info.auras" md="aura"><span ng-if="!$last">,&#32;</span></md>
		</p>
		<hr>
	</section>
	<section id="{{c.info.name.toLowerCase()}}-defense" ng-if="c.defense">
		<p>
			<b>AC</b>
			{{c.defense.ac.total()}},
			<b>touch</b>
			{{c.defense.ac.touch()}},
			<b>flat-footed</b>
			{{c.defense.ac.flatfooted()}}
			({{c.defense.ac.toString()}})
		</p>
		<p>
			<b>CMD</b>
			{{c.defense.cmd.total()}},
			<b>flat-footed</b>
			{{c.defense.cmd.flatfooted()}}
			({{c.defense.cmd.toString()}})
		</p>
		<p>
			<b>HP</b>
			{{c.info.hp}}
			({{c.info.hd}})<span ng-if="c.info.hpSpecials">;&#32;</span>
			<md c="c" ng-repeat="sp in c.info.hpSpecials" md="sp"><span ng-if="!$last">,&#32;</span></md>
		</p>
		<p>
			<b>Fortitude</b>&#32;
			<roll name="'Fortitude Save'" die="c.defense.fort.roll()"></roll>;
			<b>Reflex</b>&#32;
			<roll name="'Reflex Save'" die="c.defense.refl.roll()"></roll>;
			<b>Will</b>&#32;
			<roll name="'Will Save'" die="c.defense.will.roll()"></roll>
		</p>
		<p>
			<span ng-if="c.defense.dr">
				<b>DR</b>
				{{c.defense.dr}}<span ng-if="c.defense.immune || c.defense.resist || c.defense.sr">;&#32;</span>
			</span>
			<span ng-if="c.defense.immune">
				<b>Immune</b>&#32;
				<md c="c" ng-repeat="im in c.defense.immune" md="im"><span ng-if="!$last">,&#32;</span></md>
				<span ng-if="c.defense.resist || c.defense.sr">;&#32;</span>
			</span>
			<span ng-if="c.defense.resist">
				<b>Resist</b>&#32;
				{{c.defense.resist}}
				<span ng-if="c.defense.sr">;&#32;</span>
			</span>
			<span ng-if="c.defense.sr">
				<b>SR</b>&#32;
				{{c.defense.sr}}
			</span>
		</p>
		<p ng-if="c.defense.special">
			<b>Special</b>&#32;
			<md c="c" ng-repeat="def in c.defense.special" md="def"><span ng-if="!$last">,&#32;</span></md>
		</p>
		<hr>
	</section>
	<section id="{{c.info.name.toLowerCase()}}-offense" ng-if="c.offense">
		<p ng-repeat="(type, attacks) in c.offense.attacks">
			<b>{{type.toProperCase()}}</b>
			<span ng-repeat="attack in attacks | orderBy:'name'">
				<span ng-if="attack.quantity">{{attack.quantity}}&#32;</span>
				<md ng-if="!attack.hideName" md="attack.name">&#32;</md>
				<span ng-if="!attack.autoHit" ng-repeat="die in attack.rolls() track by $index">
					<roll name="attack.name + ' to hit'" die="die"></roll>
					<span ng-if="!$last">&#32;/&#32;</span>
					<span ng-if="$last">&#32;</span>
				</span>
				<small ng-if="attack.dc">(DC&#32;<md c='c' md="attack.dc"></md>)&#32;</small>
				<roll ng-if="attack.damage" name="attack.name + ' damage'" die="attack.damage"><span ng-if="!$last && !attack.crit && !attack.special">,</span></roll>
				<code ng-if="attack.special">
					<roll ng-if="attack.special.damage" name="attack.name + attack.special.text + ' damage'"></roll>
					<span ng-if="attack.special.text"></span>
				</code>
				<span ng-if="!$last && attack.special && !attack.crit">,&#32;</span>
				<code ng-if="attack.crit"><md c='c' md="attack.crit"></md></code>
				<span ng-if="!$last && attack.crit">,&#32;</span>
			</span>
		</p>
		<div ng-if="c.offense.spells" ng-repeat="caster in c.offense.spells | orderBy:'class'">
			<p>
				<b>{{caster.name}}</b>
				(CL
				{{caster.casterLevel.toOrdinal()}};
				concentration
				&#32;<roll name="'Concentration'" die="pf.concat('1d20', caster.concentration())"></roll>)
			</p>
			<div class="spellList">
				<md c="c" md="caster.markdown"></md>
			</div>
		</div>
		<p>
			<b>Speed</b>
			{{c.offense.speed}}
		</p>
		<p>
			<b>Space</b>
			{{c.offense.space}};
			<b>Reach</b>
			{{c.offense.reach}}
		</p>
		<p>
			<b>Base Attack Bonus</b>&#32;
			<roll name="'Base Attack'" die="pf.concat('1d20', c.stats.bab)"></roll>;
			<b>Combat Maneuver Bonus</b>&#32;
			<roll name="'Combat Maneuver to hit'" die="c.offense.cmb.rolls()[0]"></roll>
			<span ng-if="c.offense.cmb.special">&#32;({{c.offense.cmb.special}})</span>
		</p>
		<hr>
	</section>
	<section id="{{c.info.name.toLowerCase()}}-stats">
		<p>
			<span ng-repeat="ability in c.stats.scores | orderAbilityScores">
				<b>{{ability.sname.toProperCase()}}</b>
				{{ability.score()}}
				&#32;<roll name="ability.name" die="ability.roll()"></roll><span ng-if="!$last">,&#32;</span>
			</span>
		</p>
		<p ng-if="c.hasTrainedSkills()">
			<b>Trained Skills</b>
			<span class="block" ng-repeat="skill in c.skills | filterSkills:'trained' | orderObjectBy:'name'">
				<i ng-class="skill.icon()"></i>
				{{skill.name}}
				&#32;<roll name="skill.name" die="skill.roll()" validation="skill.validation"></roll><span ng-if="!$last">,&#32;</span>
			</span>
		</p>
		<p ng-if="c.hasUntrainedSkills()">
			<b>Untrained Skills</b>
			<span class="block" ng-repeat="skill in c.skills | filterSkills | orderObjectBy:'name'">
				<i ng-class="skill.icon()"></i>
				{{skill.name}}
				&#32;<roll name="skill.name" die="skill.roll()" validation="skill.validation"></roll><span ng-if="!$last">,&#32;</span>
			</span>
		</p>
		<p ng-if="c.feats">
			<b>Feats</b>&#32;
			<md c="c" ng-repeat="feat in c.feats" md="feat"><span ng-if="!$last">,&#32;</span></md>
			<span >
			</span>
		</p>
		<p ng-if="c.traits">
			<b>Traits</b>&#32;
			<md c="c" ng-repeat="trait in c.traits" md="trait"><span ng-if="!$last">,&#32;</span></md>
		</p>
		<p ng-if="c.info.languages">
			<b>Languages</b>&#32;
			<md c="c" ng-repeat="lang in c.info.languages" md="lang"><span ng-if="!$last">,&#32;</span></md>
		</p>
	</section>
	<section id="{{c.info.name.toLowerCase()}}-specials" ng-if="c.specials">
		<hr>
		<md c="c" ng-repeat="special in c.specials | orderBy:'toString()'" md="special"></md>
	</section>
	<section id="{{c.info.name.toLowerCase()}}-gear" ng-if="c.gear">
		<hr>
		<md c="c" ng-repeat="item in c.gear | orderBy:'toString()'" md="item"></md>
	</section>
	<hr ng-if="!$last">
</div>
<div ng-if="mode == 'edit'" id="{{c.info.name.toLowerCase()}}">
	<h2>
		<button type="button" class="btn btn-success btn-sm" ng-click="add.character()">Add Character</button>
		<span class="mode-switcher">
			<a download="{{blob.name}}" ng-href="{{blob.url}}"><i class="fa fa-download"></i></a>
			<i ng-click="switchMode('view')" class="fa fa-eye"></i>
		</span>
	</h2>
	<hr>
</div>
<div ng-show="mode == 'edit'" id="{{c.info.name.toLowerCase()}}" ng-repeat="c in characters">
	<button type="button" class="remove-character pull-right btn btn-danger btn-sm" ng-click="remove.character($index)">Remove Character</button>
	<form id="{{c.info.name.toLowerCase()}}-name" class="form-inline">
		<div class="form-group">
			<div class="input-group">
				<div class="input-group-addon">Name</div>
				<input ng-model="c.info.name" type="text" class="form-control">
			</div>
		</div>
		<div class="form-group">
			<div class="input-group">
				<div class="input-group-addon">CR</div>
				<input ng-model="c.info.cr" class="form-control cr" type="text">
			</div>
		</div>
		<div class="form-group">
			<div class="input-group">
				<div class="input-group-addon">MR</div>
				<input ng-model="c.info.mr" class="form-control cr" type="text">
			</div>
		</div>
		<div class="form-group">
			<label class="sr-only">Portrait</label>
			<input ng-model="c.info.portrait" type="text" class="form-control portrait" placeholder="Portrait">
		</div>
	</form>
	<section id="{{c.info.name.toLowerCase()}}-info">
		<p>
			<md c="c" ng-if="c.info.templates" md="c.info.templates">&#32;</md>
			<md c="c" ng-if="c.info.race" md="c.info.race">&#32;</md>
			<md c="c" ng-if="c.info.classes" md="c.info.classes">&#32;</md>
		</p>
		<p>
			<md c="c" ng-if="c.info.alignment" md="c.info.alignment">&#32;</md>
			<md c="c" ng-if="c.info.size" md="c.info.size">&#32;</md>
			<md c="c" ng-if="c.info.type" md="c.info.type">&#32;</md>
			<span ng-if="c.info.subtypes">(<md c="c" ng-repeat="subtype in c.info.subtypes" md="subtype"><span ng-if="!$last">,&#32;</span></md>)</span>
		</p>
		<p>
			<b>Initiative</b>&#32;
			<roll name="'Initiative'" die="pf.concat('1d20', c.info.initiative)"></roll>;
			<span ng-if="c.info.senses">
				<b>Senses</b>&#32;
				<md c="c" ng-repeat="sense in c.info.senses" md="sense"><span ng-if="!$last">,&#32;</span></md>;
			</span>
			<b>Perception</b>&#32;
			<roll name="c.perception.name" die="c.perception.roll()"></roll>
		</p>
		<p ng-if="c.info.auras">
			<b>Auras</b>&#32;
			<md c="c" ng-repeat="aura in c.info.auras" md="aura"><span ng-if="!$last">,&#32;</span></md>
		</p>
		<hr>
	</section>
	<!-- edit -->
	<!-- /edit -->
	<hr ng-if="!$last">
</div>